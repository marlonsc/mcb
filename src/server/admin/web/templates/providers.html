{% extends "base.html" %}
{% import "icons.html" as icons %}
{% block title %}Providers - MCP Context Browser{% endblock %}

{% block content %}
<div x-data="providers()" x-init="init()" class="space-y-6">
    <div class="page-header">
        <h1 class="page-title">Provider Management</h1>
        <button @click="$store.modals.addProvider = true" class="btn btn-primary">Add Provider</button>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" x-show="list.length">
        <template x-for="p in list" :key="p.id">
            <div class="card card-body">
                <div class="flex items-start gap-3">
                    <div class="icon-box icon-box-md icon-box-gradient">{{ icons::icon(name="monitor") }}</div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium truncate" x-text="p.name"></h3>
                        <p class="text-sm text-muted" x-text="p.provider_type_display"></p>
                        <span class="badge mt-1" :class="css.statusBadge(p.status_display)" x-text="p.status_display"></span>
                    </div>
                    <div class="flex gap-1">
                        <button @click="edit(p)" class="btn btn-ghost btn-sm">Edit</button>
                        <button @click="remove(p)" class="btn btn-ghost btn-sm text-danger">Delete</button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Empty -->
    <div x-show="!list.length" class="empty-state">
        <div class="empty-state-icon">{{ icons::icon(name="monitor", class="icon-xl") }}</div>
        <p class="empty-state-title">No providers configured</p>
        <p class="empty-state-text">Get started by adding your first provider.</p>
        <button @click="$store.modals.addProvider = true" class="btn btn-primary">Add Provider</button>
    </div>

    <!-- Add Modal -->
    <div x-show="$store.modals.addProvider" x-cloak class="modal-backdrop" @click.self="$store.modals.addProvider = false">
        <div class="modal" @click.stop>
            <form @submit.prevent="add()">
                <div class="modal-header"><h3 class="modal-title">Add Provider</h3></div>
                <div class="modal-body space-y-4">
                    <div>
                        <label class="input-label">Type</label>
                        <select x-model="form.provider_type" class="input">
                            <option value="">Select...</option>
                            <option value="embedding">Embedding</option>
                            <option value="vector_store">Vector Store</option>
                        </select>
                    </div>
                    <div>
                        <label class="input-label">Name</label>
                        <select x-model="form.name" class="input">
                            <option value="">Select...</option>
                            <template x-if="form.provider_type === 'embedding'">
                                <option value="openai">OpenAI</option>
                            </template>
                            <template x-if="form.provider_type === 'embedding'">
                                <option value="ollama">Ollama</option>
                            </template>
                            <template x-if="form.provider_type === 'vector_store'">
                                <option value="milvus">Milvus</option>
                            </template>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" @click="$store.modals.addProvider = false" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function providers() {
    return {
        list: [],
        form: { provider_type: '', name: '', config: {} },

        async init() { await this.load(); },

        async load() {
            try {
                const { data } = await API.get('/admin/providers');
                this.list = data || [];
            } catch (e) { toast.error(e.message); }
        },

        async add() {
            try {
                await API.post('/admin/providers', this.form);
                toast.success('Provider added');
                this.form = { provider_type: '', name: '', config: {} };
                Alpine.store('modals').addProvider = false;
                await this.load();
            } catch (e) { toast.error(e.message); }
        },

        edit(p) { toast.warning('Edit not implemented'); },

        async remove(p) {
            if (!confirm(`Delete "${p.name}"?`)) return;
            try {
                await API.delete(`/admin/providers/${p.id}`);
                toast.success('Deleted');
                await this.load();
            } catch (e) { toast.error(e.message); }
        }
    };
}
</script>
{% endblock %}
