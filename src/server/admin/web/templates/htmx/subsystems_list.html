{% import "icons.html" as icons %}
{% for subsystem in subsystems %}
<div class="card card-body" data-subsystem-id="{{ subsystem.id }}">
    <div class="flex items-start justify-between">
        <div class="flex items-start gap-3">
            <div class="icon-box icon-box-md icon-box-gradient">
                {% if subsystem.subsystem_type == "embedding" %}
                {{ icons::icon(name="chip") }}
                {% elif subsystem.subsystem_type == "vector_store" %}
                {{ icons::icon(name="database-stack") }}
                {% elif subsystem.subsystem_type == "search" %}
                {{ icons::icon(name="search") }}
                {% else %}
                {{ icons::icon(name="monitor") }}
                {% endif %}
            </div>
            <div class="flex-1 min-w-0">
                <h3 class="font-medium truncate">{{ subsystem.name }}</h3>
                <p class="text-sm text-muted">{{ subsystem.subsystem_type | replace(from="_", to=" ") | title }}</p>
                <span class="badge mt-1 {% if subsystem.status == 'running' %}badge-success{% elif subsystem.status == 'error' %}badge-danger{% else %}badge-gray{% endif %}">{{ subsystem.status|title }}</span>
                <div class="mt-2 grid grid-cols-3 gap-2 text-xs text-muted">
                    <div>CPU: {{ subsystem.metrics.cpu_percent | round(precision=1) }}%</div>
                    <div>Mem: {{ subsystem.metrics.memory_mb }}MB</div>
                    <div>Req/s: {{ subsystem.metrics.requests_per_sec | round(precision=1) }}</div>
                </div>
            </div>
        </div>
        <div class="flex gap-1">
            <button hx-post="/admin/subsystems/{{ subsystem.id }}/signal" hx-vals='{"signal":"restart"}' hx-swap="none" hx-confirm="Restart {{ subsystem.name }}?" class="btn btn-ghost btn-sm">Restart</button>
            {% if subsystem.status == "running" %}
            <button hx-post="/admin/subsystems/{{ subsystem.id }}/signal" hx-vals='{"signal":"pause"}' hx-swap="none" class="btn btn-ghost btn-sm">Pause</button>
            {% elif subsystem.status == "paused" %}
            <button hx-post="/admin/subsystems/{{ subsystem.id }}/signal" hx-vals='{"signal":"resume"}' hx-swap="none" class="btn btn-ghost btn-sm">Resume</button>
            {% endif %}
        </div>
    </div>
    <div class="mt-3 pt-3 card-divider text-xs">
        <span class="{% if subsystem.health.status == 'healthy' %}text-success{% elif subsystem.health.status == 'degraded' %}text-warning{% else %}text-danger{% endif %}">{{ subsystem.health.status|title }}</span>
        <span class="mx-2 text-muted">|</span>
        <span class="text-muted">{{ subsystem.health.message }}</span>
    </div>
</div>
{% endfor %}
