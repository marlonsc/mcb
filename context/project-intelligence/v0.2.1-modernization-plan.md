# v0.2.1 Modernization And Removal Plan

Last updated: 2026-02-12 (America/Sao_Paulo)

## Purpose

Document evidence-backed candidates for modernization/removal: incomplete,
legacy, dead-code, mock-only leakage, and overengineered patterns.

## Evidence Scope

- Internal code scans: `grep`, `rg`, `sg`, AST pattern checks.
- Source hotspots in `crates/` and supporting docs in `docs/`.
- External tooling references from official Rust ecosystem sources.

## High-Confidence Candidates

- ~~`incomplete`: multi-tenant org extraction TODOs~~
  - **COMPLETED** (2026-02-12, Beads `mcb-xqdd`): Centralized org-context
    resolver via `extract_org_context()` helper. Default-org fallback removed
    from all MCP/admin handlers.
- ~~`incomplete`: lock abstraction without implementation~~
  - **COMPLETED** (2026-02-12, Beads `mcb-ah3e`): Lock and cache contracts
    aligned with implementation reality; stale port surface constrained.
- ~~`incomplete`: per-entry cache config ignored by Moka provider~~
  - **COMPLETED** (2026-02-12, Beads `mcb-ah3e`): Cache contract docs updated
    to reflect actual Moka provider semantics.
- ~~`dead-code`: explicit suppression~~
  - **COMPLETED** (2026-02-12, Beads `mcb-ox8o`): All production dead-code
    suppressions removed or replaced with concrete usage wiring.
- ~~`hardcoded-fallback`: fixed sqlite provider~~
  - **COMPLETED** (2026-02-12, Beads `mcb-8478`): Config-driven database
    selection with explicit default policy and documentation.
- `incomplete`: `crates/mcb-application/src/use_cases/validation_service.rs`
  - No-op stub service returning empty/default results.
  - Status: Deferred to v0.3.0 — kept as explicit adapter-only shell.

## Overengineered Hotspots (Refactor Candidates)

- ~~Entity handler duplication (`match(action, resource)` boilerplate)~~
  - **COMPLETED** (2026-02-12, Beads `mcb-b37e`): Consolidated MCP entity
    handler dispatch via shared helpers. Boilerplate reduced.
- ~~Provider boilerplate families~~
  - **COMPLETED** (2026-02-12, Beads `mcb-3yp3`): Embedding/vector-store
    provider boilerplate consolidated.
- ~~Validation engine stack complexity~~
  - **COMPLETED** (2026-02-12, Beads `mcb-lwmc`): Engine portfolio rationalized.
    Duplicate engine instantiation eliminated; architecture documented in
    `crates/mcb-validate/src/engines/mod.rs`.
- Admin CRUD adapter repetition:
  - `crates/mcb-server/src/admin/crud_adapter.rs`
  - Status: Deferred — adapter pattern is intentional for entity isolation.

## Non-Blocking Or Test-Only Findings

- `todo!()`/`unimplemented!()` occurrences are primarily in fixtures and validator
  detection samples, not runtime paths.
- `#[allow(dead_code)]` in integration golden tests is test-fixture local.

## External Tooling For Modernization

- `cargo-machete`: fast stable unused-dependency detection (CI-friendly).
- `cargo-udeps`: precise unused dependency audit (nightly, deeper pass).
- `cargo-deny`: vulnerability/license/source policy gate.
- `cargo-semver-checks`: public API break detection in release workflow.
- `cargo-outdated`: stale dependency reporting.

## Prioritized Execution Matrix

- P0 — **ALL COMPLETED** (2026-02-12)
  - ~~Resolve multi-tenant org-context TODOs in MCP/admin handlers.~~ (`mcb-xqdd`)
  - ~~Align lock/cache contracts with implementation reality.~~ (`mcb-ah3e`)
  - ~~Remove or justify dead-code suppression in production modules.~~ (`mcb-ox8o`)
- P1 — **ALL COMPLETED** (2026-02-12)
  - ~~Consolidate duplicated entity handler dispatch logic.~~ (`mcb-b37e`)
  - ~~Consolidate provider boilerplate (embedding/vector-store families).~~ (`mcb-3yp3`)
  - ~~Convert hardcoded sqlite fallback to config-driven selection.~~ (`mcb-8478`)
- P2 — **ALL COMPLETED** (2026-02-12)
  - ~~Rationalize validation engine portfolio and remove overlap.~~ (`mcb-lwmc`)
  - ~~Clean documentation drift where old gap docs still mark fixed items.~~ (`mcb-ci21`)

## Safe Modernization Rules

- Prefer internal consolidation first; add new external dependency only when it
  removes meaningful maintenance burden with clear support signal.
- Any removal requires: equivalent behavior proof, test coverage, and migration
  note in release docs.
- Keep context files MVI-sized and update after each completed P0/P1 closure.

## Verification Checklist For Each Cleanup PR

- Reproduce finding with search evidence.
- Confirm no behavior regression with targeted tests.
- Update related docs and context snapshots.
- Add follow-up Beads issue when intentionally deferred.

## Update Notes

- 2026-02-12: Added evidence-backed modernization/removal plan for v0.2.1,
  including incomplete, dead-code, and overengineering candidates.
- 2026-02-12: Marked all P0/P1/P2 items as COMPLETED. Epic `mcb-b9qd` closed.
