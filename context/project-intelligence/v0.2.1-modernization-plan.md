# v0.2.1 Modernization And Removal Plan

Last updated: 2026-02-12 (America/Sao_Paulo)

## Purpose

Document evidence-backed candidates for modernization/removal: incomplete,
legacy, dead-code, mock-only leakage, and overengineered patterns.

## Evidence Scope

- Internal code scans: `grep`, `rg`, `sg`, AST pattern checks.
- Source hotspots in `crates/` and supporting docs in `docs/`.
- External tooling references from official Rust ecosystem sources.

## High-Confidence Candidates

- `incomplete`: `crates/mcb-application/src/use_cases/validation_service.rs`
  - No-op stub service returning empty/default results.
  - Action: keep as explicit adapter-only shell or replace with injected concrete
    facade that fails loudly when DI is missing.
- `incomplete`: multi-tenant org extraction TODOs
  - `crates/mcb-server/src/handlers/project.rs`
  - `crates/mcb-server/src/handlers/plan_entity.rs`
  - `crates/mcb-server/src/handlers/issue_entity.rs`
  - `crates/mcb-server/src/handlers/vcs_entity.rs`
  - `crates/mcb-server/src/admin/handlers.rs`
  - Action: centralize auth-context-to-org resolver and remove default-org fallback.
- `incomplete`: lock abstraction without implementation
  - `crates/mcb-domain/src/ports/infrastructure/lock.rs`
  - Action: add concrete lock provider or remove/limit port surface until needed.
- `incomplete`: per-entry cache config ignored by Moka provider
  - `crates/mcb-providers/src/cache/moka.rs`
  - Action: implement per-entry semantics or constrain API contract docs.
- `dead-code`: explicit suppression
  - `crates/mcb-providers/src/database/sqlite/mod.rs` (`#[allow(dead_code)]`)
  - Action: remove suppression by wiring usage or deleting dormant module.
- `hardcoded-fallback`: fixed sqlite provider
  - `crates/mcb-infrastructure/src/di/database_resolver.rs`
  - Action: read provider from config with explicit default policy and docs.

## Overengineered Hotspots (Refactor Candidates)

- Entity handler duplication (`match(action, resource)` boilerplate):
  - `crates/mcb-server/src/handlers/org_entity.rs`
  - `crates/mcb-server/src/handlers/issue_entity.rs`
  - `crates/mcb-server/src/handlers/vcs_entity.rs`
  - `crates/mcb-server/src/handlers/plan_entity.rs`
  - Action: introduce shared dispatch helpers or macro/template generation.
- Admin CRUD adapter repetition:
  - `crates/mcb-server/src/admin/crud_adapter.rs`
  - Action: generic adapter factory over repository traits.
- Provider boilerplate families:
  - Embeddings: `crates/mcb-providers/src/embedding/*.rs`
  - Vector stores: `crates/mcb-providers/src/vector_store/*.rs`
  - Action: common HTTP provider core + provider-specific endpoint mapping.
- Validation engine stack complexity:
  - `crates/mcb-validate/src/engines/`
  - Action: define supported engine matrix and retire low-value overlap.

## Non-Blocking Or Test-Only Findings

- `todo!()`/`unimplemented!()` occurrences are primarily in fixtures and validator
  detection samples, not runtime paths.
- `#[allow(dead_code)]` in integration golden tests is test-fixture local.

## External Tooling For Modernization

- `cargo-machete`: fast stable unused-dependency detection (CI-friendly).
- `cargo-udeps`: precise unused dependency audit (nightly, deeper pass).
- `cargo-deny`: vulnerability/license/source policy gate.
- `cargo-semver-checks`: public API break detection in release workflow.
- `cargo-outdated`: stale dependency reporting.

## Prioritized Execution Matrix

- P0
  - Resolve multi-tenant org-context TODOs in MCP/admin handlers.
  - Align lock/cache contracts with implementation reality.
  - Remove or justify dead-code suppression in production modules.
- P1
  - Consolidate duplicated entity handler dispatch logic.
  - Consolidate provider boilerplate (embedding/vector-store families).
  - Convert hardcoded sqlite fallback to config-driven selection.
- P2
  - Rationalize validation engine portfolio and remove overlap.
  - Clean documentation drift where old gap docs still mark fixed items.

## Safe Modernization Rules

- Prefer internal consolidation first; add new external dependency only when it
  removes meaningful maintenance burden with clear support signal.
- Any removal requires: equivalent behavior proof, test coverage, and migration
  note in release docs.
- Keep context files MVI-sized and update after each completed P0/P1 closure.

## Verification Checklist For Each Cleanup PR

- Reproduce finding with search evidence.
- Confirm no behavior regression with targeted tests.
- Update related docs and context snapshots.
- Add follow-up Beads issue when intentionally deferred.

## Update Notes

- 2026-02-12: Added evidence-backed modernization/removal plan for v0.2.1,
  including incomplete, dead-code, and overengineering candidates.
