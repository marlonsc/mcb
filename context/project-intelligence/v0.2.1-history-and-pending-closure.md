# v0.2.1 History and Pending Closure

Last updated: 2026-02-12
Scope: recovery context for `release/v0.2.1`

## Why this file exists

This document consolidates implementation history, planning artifacts, research, and pending closure work for the v0.2.1 line, so future sessions can resume execution without re-discovery.

## Evidence baseline used

- Version/branch state: `Cargo.toml`, `git log` on `release/v0.2.1`.
- Delivery history: `docs/operations/CHANGELOG.md`.
- Gap and integration plans: `docs/plan/MCB-GAPS-REPORT.md`, `docs/plan/MCB-COMPREHENSIVE-GAPS.md`, `docs/plan/OPENCODE-INTEGRATION-PLAN.md`, `docs/plan/OPENCODE-MCB-MIGRATION-PLAN.md`, `docs/plan/MCB-VALIDATION-REPORT.md`.
- Current project context: `docs/context/project-state.md`.
- Real implementation references: `crates/mcb-server/src/admin/crud_adapter.rs`, `crates/mcb-server/src/admin/web/lov_handlers.rs`, `crates/mcb-server/src/templates/engine/handlebars_engine.rs`, `crates/mcb-providers/src/database/sqlite/ensure_parent.rs`, `crates/mcb-application/src/services/repository_resolver.rs`, `crates/mcb-server/tests/handlers/real_persistence_tests.rs`.
- Open work inventory: `bd stats --json`, `bd ready --json`, `bd blocked --json` (executed 2026-02-12).

## High-confidence timeline (v0.2.0 -> v0.2.1 line)

1. **v0.2.0 released (2026-02-10)**
   - Stabilization release with DDL hardening, strict MCP argument validation, startup smoke tests, and broad documentation cleanup.
   - Source: `docs/operations/CHANGELOG.md`.

2. **v0.2.1 branch work concentrated on admin and data-model hardening**
   - Commit stream shows major Admin UI and data model activity, including LOV endpoints, filtering/pagination, template migration, and contextual error fixes.
   - Source: `git log --oneline -n 60` on `release/v0.2.1`.

3. **Branch currently contains merged forward work**
   - `release/v0.2.1` has merges from `release/v0.2.1` and feature branches, so closure planning must separate true v0.2.1 blockers from v0.2.1+ enhancement scope.

## What was implemented (code-grounded)

### 1) Admin CRUD orchestration matured

- Entity adapter abstraction supports list/get/create/update/delete across org/issue/plan/vcs domains via unified trait.
- In-memory filter pipeline includes search, date-range, sorting, and pagination.
- Evidence: `crates/mcb-server/src/admin/crud_adapter.rs`.

### 2) LOV endpoint system added for FK UX

- Dedicated endpoint returns `[{id,label}]` for dropdowns.
- Supports query filtering and parent-dependent filtering.
- Evidence: `crates/mcb-server/src/admin/web/lov_handlers.rs`.

### 3) Tera -> Handlebars migration completed in server templates

- Engine uses Handlebars registration and render pipeline with explicit failure logging.
- Evidence: `crates/mcb-server/src/templates/engine/handlebars_engine.rs`.

### 4) v0.2.1 "honesty fix" persisted behavior guarded by tests

- Real persistence tests assert operations actually write/read from real providers (not mock-success paths).
- Test comments explicitly reference v0.2.1 honesty behavior.
- Evidence: `crates/mcb-server/tests/handlers/real_persistence_tests.rs`.

### 5) FK safety via auto-parent guarantees in SQLite flow

- Auto-creates default org and project to satisfy write paths requiring FK parents.
- Evidence: `crates/mcb-providers/src/database/sqlite/ensure_parent.rs`.

### 6) DB-first project/repository resolution introduced

- Resolver checks existing repo registration first, then registers idempotently.
- Supports submodule-aware resolution and normalized URLs.
- Evidence: `crates/mcb-application/src/services/repository_resolver.rs`.

## Planning/research synthesis relevant to closure

### Integration gap status (reconciled 2026-02-12)

- `mcp_mcb_project` partial implementation — deferred to v0.3.0 project workflow scope.
- Memory list/query SQL bug — partially fixed in v0.2.0; full fix deferred to v0.3.0.
- Context unification — v0.3.0/v0.4.0 scope (not a v0.2.1 blocker).
- Historical gap reports (`MCB-GAPS-REPORT.md`, `MCB-COMPREHENSIVE-GAPS.md`) now carry
  superseded headers — they are v0.3.0+ roadmap inputs, not v0.2.1 blockers.
- Sources: `docs/plan/MCB-GAPS-REPORT.md`, `docs/plan/MCB-VALIDATION-REPORT.md`, `docs/plan/MCB-COMPREHENSIVE-GAPS.md`.

### Roadmap tension to manage

- v0.3.0/v0.4.0 architecture work is well-specified but should not be mixed into v0.2.1 release closure unless explicitly required.
- Sources: `docs/developer/ROADMAP.md`, `docs/context/project-state.md`.

## Current open-work signal (Beads snapshot)

- Totals (at capture time): 295 issues, 74 open, 36 blocked, 38 ready, 1 in progress.
- In-progress item includes historical-closure documentation task: `mcb-vi4f`.
- Multiple blocked issues map to v0.3.0/v0.4.0 ADR execution (not all are v0.2.1 release blockers).

## Pending closure matrix for v0.2.1 line — COMPLETED

### A) Release-critical closure — ALL DONE (2026-02-12)

1. ~~**Re-validate branch correctness against intended release scope**~~
   - **DONE**: `release/v0.2.1` consolidated via commit `e776cd86`. Scope locked.

2. ~~**Run full quality gate for current branch state**~~
   - **DONE**: `cargo check` ✅, `cargo fmt` ✅, `make lint CI_MODE=1` ✅,
     `make test SCOPE=all TEST_THREADS=4` ✅ (28 suites), `actionlint` ✅,
     `yamllint` ✅, `zizmor --min-confidence=medium` ✅.

3. ~~**Close or downgrade known blocker gaps that were marked hotfix-level**~~
   - **DONE**: Historical GAP-1/GAP-2/GAP-4 re-tested; gap docs carry
     superseded headers. Corresponding Beads issues closed or deferred.

4. ~~**Publish branch-consistent release notes**~~
   - **DONE**: Changelog and context docs synchronized with actual branch content.

### B) Confirmed out of v0.2.1 scope (roadmap continuation)

- Phase 8/9 execution tasks (v0.3.0/v0.4.0), including Workflow FSM full rollout, CodeGraph, ContextSnapshot, TantivyBM25, and context timeline tooling.
- These remain in Beads as blocked items under their respective epics.
- Decision: no scope changes required for v0.2.1 finalization.

## Execution order to finish pending closure work

1. **Scope lock**: produce exact v0.2.1 closure boundary doc (commits + features + exclusions).
2. **Verification run**: execute release-quality checks and capture results in one artifact.
3. **Gap reconciliation**: validate old blocker reports against current code; close stale blockers.
4. **Release documentation sync**: update changelog + context docs + Beads status in one pass.

## Operational commands for next session

```bash
# 1) Scope and history
git log --oneline --decorate --graph release/v0.2.1

# 2) Current quality checks
cargo check
cargo test

# 3) Pending work inventory
bd stats --json
bd ready --json
bd blocked --json

# 4) Validate context docs
scripts/context/validate-context.sh
```

## Risks if closure is skipped

- Mixing v0.2.1 and v0.2.1+ scope causes ambiguous release claims.
- Historical gap docs can become misleading if not reconciled with current code.
- Future planning sessions may over-prioritize blocked roadmap work instead of true release blockers.

## References

- `docs/operations/CHANGELOG.md`
- `docs/context/project-state.md`
- `docs/plan/MCB-GAPS-REPORT.md`
- `docs/plan/MCB-COMPREHENSIVE-GAPS.md`
- `docs/plan/MCB-VALIDATION-REPORT.md`
- `docs/plan/OPENCODE-INTEGRATION-PLAN.md`
- `docs/plan/OPENCODE-MCB-MIGRATION-PLAN.md`

## Deep implementation evidence index

This section maps concrete implementation domains to code evidence and planning intent.

### Admin and UI delivery stream

| Domain | Evidence file(s) | Why it matters for v0.2.1 closure |
|---|---|---|
| Entity CRUD adapter layer | `crates/mcb-server/src/admin/crud_adapter.rs` | Confirms broad admin capability landed in code, not only in planning docs. |
| LOV endpoint for FK dropdowns | `crates/mcb-server/src/admin/web/lov_handlers.rs` | Confirms UI usability support required for foreign-key driven forms. |
| Admin route assembly | `crates/mcb-server/src/admin/routes.rs` | Confirms route-level integration in HTTP surface. |
| Admin handlers and API | `crates/mcb-server/src/admin/handlers.rs`, `crates/mcb-server/src/admin/api.rs` | Confirms operational and telemetry endpoints coexist with CRUD UI. |
| Template engine and fairing wiring | `crates/mcb-server/src/templates/engine/handlebars_engine.rs`, `crates/mcb-server/src/templates/fairing.rs` | Confirms Tera -> Handlebars migration is executable at runtime. |

### Persistence and data integrity stream

| Domain | Evidence file(s) | Why it matters |
|---|---|---|
| Parent bootstrap for FK-safe writes | `crates/mcb-providers/src/database/sqlite/ensure_parent.rs` | Prevents silent write failures when org/project rows do not exist. |
| SQLite provider lifecycle and DDL | `crates/mcb-providers/src/database/sqlite/provider.rs`, `crates/mcb-providers/src/database/sqlite/ddl.rs` | Critical for startup correctness and schema evolution stability. |
| Query execution abstraction | `crates/mcb-providers/src/database/sqlite/executor.rs` | Confirms parameterized SQL flow and adapter-level consistency. |
| Repository resolver service | `crates/mcb-application/src/services/repository_resolver.rs` | Confirms DB-first behavior and idempotent registration strategy. |

### Quality and behavior guarantees stream

| Domain | Evidence file(s) | Why it matters |
|---|---|---|
| Honesty behavior tests | `crates/mcb-server/tests/handlers/real_persistence_tests.rs` | Guards against success-without-persistence regressions. |
| Error mapping strategy | `crates/mcb-server/src/error_mapping.rs` | Determines whether failures are contextual and diagnosable. |
| Instrumentation discipline | `crates/mcb-server/src/handlers/*`, `crates/mcb-server/src/admin/*` | Confirms widespread `tracing::instrument` and structured logs. |

## Commit stream annotation (recent release-line highlights)

Observed from `git log --oneline --decorate -n 60` on `release/v0.2.1`.

### Core branch and release progression

- `33489aec` set development version `0.2.1-dev`.
- `2d781f38` set version to `0.2.1` and simplified collection normalization.
- `31f124dc` moved line to `0.2.1-dev` (forward development continuation).
- `9fe5a8f3` merged `feat/data-model-v2` into `release/v0.2.1`.
- `b8d08230` merged `release/v0.2.1` back into `release/v0.2.1`.

### Admin/UI feature wave evidence

- `663a532e` added pagination, sort, and search in `EntityCrudAdapter` path.
- `ec2a952e` added LOV endpoint system for FK dropdown population.
- `257f61c3` added component partials and dependent filtering integration.
- `783f8370` added advanced pattern partials and bulk delete endpoint.
- `807d43cc` added entity dashboard counts and totals.
- `4d5d1632` added collapsible entity groups in sidebar.
- `4cc2932d` improved entity templates with type-aware rendering.

### Template and rendering migration evidence

- `0c126590` removed Tera and standardized on Handlebars.
- `4ca9cdd4` added custom Handlebars helpers.
- `b7b3c95d` inlined rocket_dyn_templates internal module and migrated to Handlebars 6.x.

### Integrity and correctness fixes evidence

- `24cb7f83` contextual errors, agent types, FK auto-create, and real persistence tests.
- `ab38d09e` completed chrono->i64 migration and DDL count fixes.
- `cd903668` updated DDL test counts for plan entity indexes.
- `c184281d` applied PR #94 review fixes and CI optimizations.

### Operational conclusion

The commit stream shows v0.2.1 is not a narrow hotfix line; it includes substantial feature movement and back-merges. Closure must therefore be based on **actual branch content and tests**, not only on release naming.

## Plan and report reconciliation matrix

This matrix reconciles major plan artifacts with current line reality.

| Artifact | Primary intent | Still relevant to v0.2.1 closure? | Required action |
|---|---|---|---|
| `docs/operations/CHANGELOG.md` | Official release narrative | Yes (mandatory) | Add branch-consistent closure entry once scope is locked. |
| `docs/plan/MCB-VALIDATION-REPORT.md` | Tool validation and gap list | Yes (partial) | Re-run key checks; mark stale findings resolved or still open. |
| `docs/plan/MCB-GAPS-REPORT.md` | Initial integration blockers | Yes (partial) | Convert from hypothesis to verified current status. |
| `docs/plan/MCB-COMPREHENSIVE-GAPS.md` | Future-oriented architectural gaps | Limited | Keep as roadmap input; do not treat all as v0.2.1 blockers. |
| `docs/plan/OPENCODE-INTEGRATION-PLAN.md` | Integration strategy across phases | Yes (strategic) | Extract only immediate closure-critical gates. |
| `docs/plan/OPENCODE-MCB-MIGRATION-PLAN.md` | Full migration map | Mostly future | Keep as post-closure continuation guide. |
| `docs/developer/ROADMAP.md` | Version progression | Yes (context) | Use for scope boundary protection. |
| `docs/context/project-state.md` | Session-state snapshot | Yes | Keep synchronized with closure decisions and Beads numbers. |

## Pending inventory decomposition (closure-focused)

### Tier 1: Immediate release-line closure tasks

1. Branch-scope lock for `release/v0.2.1`.
2. Full branch quality run and evidence capture.
3. GAP verification rerun for historically flagged blockers.
4. Changelog and context synchronization.

### Tier 2: High-priority but likely post-closure roadmap tasks

- Workflow FSM full rollout (ADR-034 family).
- ContextScout/Policy/Orchestrator implementation blocks.
- CodeGraph + ContextSnapshot + TantivyBM25 stream.

### Tier 3: Documentation debt and context hygiene

- Align all context files to English-only policy.
- Reconcile conflicting project-state snapshots (`docs/context` vs `context/project-intelligence`).
- Keep external guides aligned with actual crate usage.

## Beads evidence snapshot (captured during this session)

### Global counts

- Total issues: 295
- Open: 74
- In progress: 1
- Closed: 220
- Blocked: 36
- Ready: 38

### In-progress issue

- `mcb-vi4f`: v0.2.1 implementation history and pending closure matrix (directly related to this context stream).

### Ready queue signal (top sample)

- `mcb-gi1b`: Epic for v0.2.1 admin UI schema-driven automation.
- `mcb-r60s`: T14 multi-select tags partial.
- `mcb-xgvi`: T15 cascading select partial.
- `mcb-ywro`: T16 date range picker partial.
- `mcb-nykd`: T17 JSON editor partial.
- `mcb-rrrg`: T18 bulk row selection/actions.

### Blocked queue signal (representative high-priority sample)

- `mcb-v9o3` GAP-D2 CodeGraph entity (blocked by `mcb-6pjx`).
- `mcb-llfp` GAP-D3 ContextSnapshot entity (blocked by `mcb-6pjx`).
- `mcb-4u57` GAP-D4 WorkflowEngine port (blocked by `mcb-bphe`).
- `mcb-onib` GAP-P1 TantivyBM25 (blocked by `mcb-bphe`).
- `mcb-ftvv` GAP-P2 TreeSitterExtractor centralization (blocked by `mcb-6pjx`).

Interpretation: blocked inventory is dominated by v0.3.0+/v0.4.0 streams; closure workflow should isolate these from v0.2.1 release criteria unless explicitly promoted.

## Critical closure criteria (definition of done for release-line finalization)

The following criteria should be treated as mandatory before declaring v0.2.1 line closed:

1. **Scope certainty**
   - A signed-off list of included commits/features.
   - Explicit list of excluded forward-branch functionality.

2. **Technical verification**
   - `cargo check` passes on branch head.
   - Relevant integration suites pass (especially persistence, admin handlers, startup smoke).
   - No unresolved runtime startup regressions related to SQLite schema/bootstrap.

3. **Behavioral integrity**
   - Persistence paths prove real write/read behavior (honesty test class).
   - Error paths are contextual and actionable.
   - Tool argument validation remains strict (JSON-RPC compliance).

4. **Documentation integrity**
   - Changelog entry matches actual branch content.
   - Context files updated in English with traceable references.
   - Pending closure matrix and follow-up roadmap are separated.

5. **Work tracking integrity**
   - Release blockers in Beads are either closed, downgraded, or explicitly deferred with rationale.
   - No hidden blockers remain in docs-only reports.

## Closure runbook (operator-ready)

### Step 0 - Baseline capture

```bash
git rev-parse --abbrev-ref HEAD
git log --oneline --decorate -n 120
bd stats --json
bd ready --json
bd blocked --json
```

### Step 1 - Scope lock

```bash
# compare intended release branch with origin/main baseline
git log --oneline origin/main..release/v0.2.1
git log --oneline release/v0.2.1..origin/main
```

Deliverable: one markdown artifact listing included/excluded commit groups.

### Step 2 - Build and tests

```bash
cargo check
cargo test
```

If time constrained, at minimum include targeted suites for:

- `crates/mcb-server/tests/handlers/real_persistence_tests.rs`
- startup smoke integration tests
- admin handler integration tests

### Step 3 - Gap rerun

Re-check historical blockers against current code and tests:

- GAP-1 (`mcp_mcb_project` status)
- GAP-2 (memory list/query behavior)
- GAP-4 (context search resource support)

### Step 4 - Documentation and issue closure sync

Update:

- `docs/operations/CHANGELOG.md`
- `docs/context/project-state.md`
- `context/project-intelligence/project-state.md`
- this file (`v0.2.1-history-and-pending-closure.md`)

Then reconcile Beads statuses and close closure-specific tasks.

## Known ambiguity and how to handle it

### Ambiguity: v0.2.1 line includes v0.2.1 merges

Potential interpretations:

- **Interpretation A (strict release-line):** only intended v0.2.1 scope should count.
- **Interpretation B (branch-reality):** everything present on `release/v0.2.1` at closure time counts.

Recommended default for recoverability: use **Interpretation B** for technical verification, but publish explicit scope notes in release docs to avoid semantic confusion.

## Module-level quality observations (current confidence)

### Admin module

- Strength: broad adapter abstraction and route-level coverage.
- Risk: in-memory filtering can become heavy on large datasets if backend-level filtering is not consistently used.

### SQLite provider module

- Strength: parent bootstrap pattern improves FK reliability.
- Risk: schema/version drift can still create startup-edge cases if migrations and DDL assumptions diverge.

### Template/rendering module

- Strength: single-engine standardization on Handlebars simplifies ops.
- Risk: helper and partial expansion in v0.2.1+ may increase coupling unless rigorously tested.

### Repository resolver module

- Strength: DB-first idempotent registration and submodule-aware path.
- Risk: fallback behavior can hide repo mismatch if normalization assumptions change.

## Suggested closure artifacts to generate next

1. `docs/plan/v0.2.1-scope-lock.md`
2. `docs/plan/v0.2.1-verification-report.md`
3. `docs/plan/v0.2.1-gap-reconciliation.md`
4. Changelog closure entry in `docs/operations/CHANGELOG.md`

Each artifact should include:

- timestamp
- branch/commit hash
- exact commands run
- pass/fail status
- owner and follow-up links

## Quick recovery checklist for future sessions

- [ ] Re-run Beads snapshot (`stats`, `ready`, `blocked`).
- [ ] Re-run branch quality checks.
- [ ] Confirm if closure scope changed since last sync.
- [ ] Reconcile any stale blocker reports.
- [ ] Update this file and `project-state.md` in same commit.

## Changelog alignment notes (for writer)

When writing final closure notes:

- separate **stabilization fixes** from **feature carryovers**,
- state clearly that branch contains merged forward development,
- include explicit mention of honesty/persistence guard tests,
- include explicit mention of admin UI and Handlebars migration state.

## Traceability anchors

Use these references when validating statements in this file:

- Commit history source: `git log --oneline --decorate -n 60` run on 2026-02-12.
- Beads source: `bd stats --json`, `bd ready --json`, `bd blocked --json` run on 2026-02-12.
- Test integrity source: `crates/mcb-server/tests/handlers/real_persistence_tests.rs`.
- Admin integration source: `crates/mcb-server/src/admin/*`.
- Persistence safeguards source: `crates/mcb-providers/src/database/sqlite/*`.

## Final note

This document is intentionally conservative: if a claim is not directly evidenced by code, command output, or planning artifacts, it is treated as a hypothesis and not as closure truth.
