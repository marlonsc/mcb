---
# =============================================================================
# GitHub Pages Deployment
# =============================================================================
# Manual workflow: triggered via workflow_dispatch only
# Superseded by release.yml for tag-triggered deployment.
# This workflow is kept as a manual emergency fallback only.
# Uses the shared docs-build.yml reusable workflow.
# =============================================================================

name: Pages

permissions:
  contents: read

on: # yamllint disable-line rule:truthy
  workflow_dispatch:

concurrency:
  group: pages-${{ github.ref }}
  cancel-in-progress: true

jobs:
  docs:
    name: Build, Validate & Deploy Documentation
    uses: ./.github/workflows/docs-build.yml
    with:
      deploy: true
      validate: true
      rust-cache-save: false
    permissions:
      contents: write

  summary:
    name: Deployment Summary
    runs-on: ubuntu-latest
    needs: [docs]
    if: always()
    steps:
      - name: Report Status
        env:
          DEPLOY_RESULT: ${{ needs.docs.result }}
          REPO: ${{ github.repository }}
        run: |
          {
            echo "## GitHub Pages Deployment"
            echo ""
            if [[ "$DEPLOY_RESULT" == "success" ]]; then
              echo "[OK] Documentation deployed successfully"
              echo ""
              echo "View at: https://${REPO%%/*}.github.io/${REPO##*/}/"
            else
              echo "[FAIL] Deployment failed: $DEPLOY_RESULT"
            fi
          } >> "$GITHUB_STEP_SUMMARY"
