# Architecture Overview

## ğŸ—ï¸ System Architecture

MCP Context Browser implements a clean, modular architecture following SOLID principles, designed for maintainability and extensibility.

### Architecture Layers

The system is organized into clear architectural layers with well-defined responsibilities:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP Context Browser                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 MCP Server Layer                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚   MCP       â”‚ â”‚   Tool     â”‚ â”‚   Message   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Protocol    â”‚ â”‚ Handlers   â”‚ â”‚ Processing  â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Business Logic Layer                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Context     â”‚ â”‚ Indexing    â”‚ â”‚ Search      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Service     â”‚ â”‚ Service     â”‚ â”‚ Service     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                Provider Layer                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Embedding   â”‚ â”‚ Vector      â”‚ â”‚ File        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Providers   â”‚ â”‚ Store       â”‚ â”‚ System      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚             â”‚ â”‚ Providers   â”‚ â”‚ Provider    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 Core Layer                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚   Types     â”‚ â”‚   Errors    â”‚ â”‚   Traits    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ & Models    â”‚ â”‚   Handling  â”‚ â”‚ & Interfacesâ”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Layer Responsibilities

- **MCP Server Layer**: Protocol implementation, message handling, tool dispatch
- **Business Logic Layer**: Core application logic, service orchestration
- **Provider Layer**: Pluggable implementations for external dependencies
- **Core Layer**: Fundamental types, traits, and error handling

### Current Implementation Status

| Component | Status | Description |
|-----------|--------|-------------|
| `core` | âœ… **Complete** | Types, errors, and traits fully implemented |
| `providers/embedding` | âš ï¸ **Basic** | Mock provider implemented, framework ready for real providers |
| `providers/vector_store` | âš ï¸ **Basic** | In-memory provider implemented, ready for database integration |
| `services` | âš ï¸ **Partial** | Basic structure exists, core logic needs implementation |
| `server` | âš ï¸ **Partial** | MCP protocol framework exists, tools need completion |
| `config` | ğŸš§ **Stub** | Basic structs exist, loading mechanism needed |

### Data Flow

```
Client Request â†’ MCP Server â†’ Tool Handler â†’ Business Service â†’ Provider â†’ Response
```

#### Request Processing Flow

1. **MCP Server** receives JSON-RPC message via stdio
2. **Message Processing** parses and validates the request
3. **Tool Handler** dispatches to appropriate business logic
4. **Business Service** orchestrates operations using providers
5. **Provider** executes external operations (embeddings, storage)
6. **Response** flows back through the same layers

### Provider Architecture

The system uses a provider pattern for extensibility, allowing different implementations of the same interface.

#### Current Providers

- **EmbeddingProvider**: Converts text to vector embeddings
  - `MockEmbeddingProvider`: Fixed-dimension vectors for testing
  - Framework ready for: OpenAI, Ollama, VoyageAI implementations

- **VectorStoreProvider**: Stores and retrieves vector embeddings
  - `InMemoryVectorStoreProvider`: RAM-based storage for development
  - Framework ready for: Milvus, Pinecone, Qdrant implementations

#### Provider Registration

```rust
// Example provider registration
let mut registry = ProviderRegistry::new();
registry.register_embedding_provider("mock", Arc::new(MockEmbeddingProvider::new()));
registry.register_vector_store_provider("memory", Arc::new(InMemoryVectorStoreProvider::new()));
```

### Error Handling

The system implements comprehensive error handling with custom error types:

```rust
#[derive(Debug, Error)]
pub enum Error {
    #[error("Configuration error: {0}")]
    ConfigError(String),
    #[error("I/O error: {0}")]
    IoError(#[from] std::io::Error),
    #[error("Provider not found: {0}")]
    ProviderNotFound(String),
    // ... additional variants
}
```

### Dependency Injection

The system uses constructor injection for testability and maintainability:

```rust
pub struct ContextService {
    embedding_provider: Arc<dyn EmbeddingProvider>,
    vector_store_provider: Arc<dyn VectorStoreProvider>,
}

impl ContextService {
    pub fn new(
        embedding_provider: Arc<dyn EmbeddingProvider>,
        vector_store_provider: Arc<dyn VectorStoreProvider>,
    ) -> Self {
        Self {
            embedding_provider,
            vector_store_provider,
        }
    }
}
```

### Testing Strategy

- **Unit Tests**: Test individual components in isolation
- **Integration Tests**: Test component interactions
- **MCP Protocol Tests**: Validate protocol compliance
- **Provider Tests**: Test different provider implementations

### Performance Considerations

- **Async Processing**: Tokio runtime for non-blocking operations
- **Memory Management**: Arc/RwLock for thread-safe shared state
- **Streaming**: Prepared for large codebase processing
- **Caching**: Framework ready for caching implementations

### Security Design

- **Input Validation**: All inputs validated before processing
- **Error Handling**: Sensitive information not exposed in errors
- **Resource Limits**: Configurable limits on processing resources
- **Access Control**: Framework prepared for authentication/authorization

This architecture provides a solid foundation for building a robust, extensible MCP server while maintaining clean separation of concerns and testability.
