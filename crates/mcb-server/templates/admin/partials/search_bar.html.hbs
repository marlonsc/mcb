{{!-- Search bar partial - receives entity_slug from parent template --}}
{{!-- Uses Alpine.js for client-side UX with full page navigation (consistent with sort/pagination) --}}

<div x-data="{
  search: new URLSearchParams(window.location.search).get('q') || '',
  timer: null,
  submit() {
    const params = new URLSearchParams(window.location.search);
    if (this.search) {
      params.set('q', this.search);
    } else {
      params.delete('q');
    }
    params.set('page', '1');
    window.location.href = window.location.pathname + '?' + params.toString();
  },
  debounceSubmit() {
    clearTimeout(this.timer);
    this.timer = setTimeout(() => this.submit(), 500);
  },
  clear() {
    this.search = '';
    this.submit();
  }
}" style="position: relative; max-width: 24rem;">

  {{!-- Input wrapper --}}
  <div style="position: relative; display: flex; align-items: center;">
    {{!-- Search icon --}}
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="position: absolute; left: 0.75rem; color: var(--text-muted); pointer-events: none;">
      <circle cx="11" cy="11" r="8"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>

    {{!-- Search input --}}
    <input
      type="text"
      x-model="search"
      @keyup="debounceSubmit()"
      @keydown.enter.prevent="submit()"
      placeholder="Search records..."
      style="width: 100%; border: 1px solid var(--border-color); border-radius: 0.375rem; padding: 0.625rem 0.75rem; padding-left: 2.25rem; padding-right: 2rem; background: var(--bg-primary); color: var(--text-primary); font-size: 0.875rem; margin-bottom: 0;"
    />

    {{!-- Clear button --}}
    <button
      x-cloak
      x-show="search.length > 0"
      @click="clear()"
      type="button"
      style="position: absolute; right: 0.5rem; cursor: pointer; color: var(--text-muted); background: none; border: none; font-size: 1rem; padding: 0.25rem;"
      aria-label="Clear search"
    >&times;</button>
  </div>

  {{!-- Active search indicator --}}
  <p x-show="search.length > 0" x-cloak style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
    Showing results for '<span x-text="search"></span>'
  </p>

</div>
