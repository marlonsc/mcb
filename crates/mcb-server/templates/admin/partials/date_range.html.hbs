{{!-- Date range picker partial — Alpine.js date range filter for list pages --}}
{{!-- Context: Placed above entity list table. Reads/writes query params date_from, date_to. --}}
<div x-data="{
    dateFrom: new URLSearchParams(window.location.search).get('date_from') || '',
    dateTo: new URLSearchParams(window.location.search).get('date_to') || '',
    expanded: !!(new URLSearchParams(window.location.search).get('date_from') || new URLSearchParams(window.location.search).get('date_to')),
    applyRange() {
        let params = new URLSearchParams(window.location.search);
        if (this.dateFrom) {
            params.set('date_from', this.dateFrom);
        } else {
            params.delete('date_from');
        }
        if (this.dateTo) {
            params.set('date_to', this.dateTo);
        } else {
            params.delete('date_to');
        }
        params.set('page', '1');
        window.location.search = params.toString();
    },
    setPreset(preset) {
        let now = new Date();
        let from = new Date();
        switch (preset) {
            case 'today':
                from.setHours(0, 0, 0, 0);
                break;
            case '7d':
                from.setDate(now.getDate() - 7);
                break;
            case '30d':
                from.setDate(now.getDate() - 30);
                break;
            case 'all':
                this.dateFrom = '';
                this.dateTo = '';
                this.applyRange();
                return;
        }
        this.dateFrom = from.toISOString().split('T')[0];
        this.dateTo = now.toISOString().split('T')[0];
        this.applyRange();
    },
    clearRange() {
        this.dateFrom = '';
        this.dateTo = '';
        this.applyRange();
    }
}"
style="margin-bottom: 0.75rem;">

    <button type="button"
            @click="expanded = !expanded"
            style="background: none; border: 1px solid var(--border-color); border-radius: 0.375rem; padding: 0.375rem 0.75rem; font-size: 0.8125rem; cursor: pointer; color: var(--text-secondary); display: inline-flex; align-items: center; gap: 0.375rem;"
            :style="(dateFrom || dateTo) ? 'border-color: var(--accent); color: var(--accent);' : ''">
        <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <span x-text="(dateFrom || dateTo) ? 'Date: ' + (dateFrom || '...') + ' → ' + (dateTo || '...') : 'Date Range'"></span>
    </button>

    <div x-show="expanded" x-cloak
         style="margin-top: 0.5rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-primary);">

        <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
            <label style="font-size: 0.8125rem; color: var(--text-secondary);">From:</label>
            <input type="date" x-model="dateFrom"
                   style="padding: 0.25rem 0.5rem; font-size: 0.8125rem; border: 1px solid var(--border-color); border-radius: 0.25rem; background: var(--bg-primary); color: var(--text-primary);">

            <label style="font-size: 0.8125rem; color: var(--text-secondary);">To:</label>
            <input type="date" x-model="dateTo"
                   style="padding: 0.25rem 0.5rem; font-size: 0.8125rem; border: 1px solid var(--border-color); border-radius: 0.25rem; background: var(--bg-primary); color: var(--text-primary);">

            <button type="button" @click="applyRange()"
                    class="btn btn-primary btn-sm"
                    style="font-size: 0.8125rem; padding: 0.25rem 0.75rem;">Apply</button>

            <template x-if="dateFrom || dateTo">
                <button type="button" @click="clearRange()"
                        style="background: none; border: none; cursor: pointer; font-size: 0.8125rem; color: var(--text-muted);"
                        @mouseenter="$el.style.color='var(--text-primary)'"
                        @mouseleave="$el.style.color='var(--text-muted)'">&times; Clear</button>
            </template>
        </div>

        <div style="margin-top: 0.5rem; display: flex; gap: 0.375rem;">
            <button type="button" @click="setPreset('today')"
                    style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.25rem; padding: 0.1875rem 0.5rem; font-size: 0.75rem; cursor: pointer; color: var(--text-secondary);">Today</button>
            <button type="button" @click="setPreset('7d')"
                    style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.25rem; padding: 0.1875rem 0.5rem; font-size: 0.75rem; cursor: pointer; color: var(--text-secondary);">Last 7 days</button>
            <button type="button" @click="setPreset('30d')"
                    style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.25rem; padding: 0.1875rem 0.5rem; font-size: 0.75rem; cursor: pointer; color: var(--text-secondary);">Last 30 days</button>
            <button type="button" @click="setPreset('all')"
                    style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.25rem; padding: 0.1875rem 0.5rem; font-size: 0.75rem; cursor: pointer; color: var(--text-secondary);">All time</button>
        </div>
    </div>
</div>
