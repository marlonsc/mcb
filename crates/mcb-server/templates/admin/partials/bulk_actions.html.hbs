{{!-- Bulk actions partial — Alpine.js row selection + action bar --}}
{{!-- Context: entity_slug, records. Include this in entity_list.html.hbs. --}}
{{!-- Usage: Wrap the table in x-data="bulkActions()" and add checkbox column --}}
{{!--
    This partial provides the floating action bar.
    The table needs:
    1. <th> with select-all checkbox
    2. <td> with row checkbox per record
    Both handled via Alpine.js bulkActions store below.
--}}
<div x-data="{
    selectedIds: [],
    get allSelected() {
        let checkboxes = document.querySelectorAll('input[data-bulk-row]');
        return checkboxes.length > 0 && this.selectedIds.length === checkboxes.length;
    },
    toggleAll() {
        let checkboxes = document.querySelectorAll('input[data-bulk-row]');
        if (this.allSelected) {
            this.selectedIds = [];
        } else {
            this.selectedIds = Array.from(checkboxes).map(cb => cb.value);
        }
    },
    toggleRow(id) {
        let idx = this.selectedIds.indexOf(id);
        if (idx >= 0) {
            this.selectedIds.splice(idx, 1);
        } else {
            this.selectedIds.push(id);
        }
    },
    isSelected(id) {
        return this.selectedIds.includes(id);
    },
    clearSelection() {
        this.selectedIds = [];
    },
    confirmBulkDelete() {
        if (this.selectedIds.length === 0) return;
        this.$dispatch('confirm-delete', {
            title: 'Delete ' + this.selectedIds.length + ' Record(s)',
            message: 'Are you sure you want to delete ' + this.selectedIds.length + ' selected record(s)? This action cannot be undone.',
            action: '/ui/entities/{{entity_slug}}/bulk-delete',
            extraField: { name: 'ids', value: this.selectedIds.join(',') }
        });
    }
}"
@bulk-select-row.window="toggleRow($event.detail.id)"
@bulk-toggle-all.window="toggleAll()">

    {{!-- Floating action bar — appears when items selected --}}
    <div x-show="selectedIds.length > 0"
         x-cloak
         style="position: sticky; bottom: 1rem; z-index: 40; display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; background: var(--nav-bg); color: var(--nav-text); border-radius: 0.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.25); margin-top: 1rem;"
         x-transition>
        <span style="font-size: 0.875rem; font-weight: 500;">
            <span x-text="selectedIds.length"></span> selected
        </span>
        <div style="display: flex; gap: 0.5rem;">
            <button type="button" @click="clearSelection()"
                    style="padding: 0.375rem 0.75rem; font-size: 0.8125rem; border-radius: 0.375rem; border: 1px solid rgba(255,255,255,0.3); background: transparent; color: inherit; cursor: pointer;">
                Clear
            </button>
            <button type="button" @click="confirmBulkDelete()"
                    style="padding: 0.375rem 0.75rem; font-size: 0.8125rem; border-radius: 0.375rem; border: none; background: var(--color-error); color: white; cursor: pointer;">
                Delete Selected
            </button>
        </div>
    </div>
</div>
