{{!-- Pagination controls partial --}}
{{!-- Context: page, per_page, total_count, total_pages, entity_slug --}}
{{!-- Also uses: search (q value), sort_field, sort_order from parent context --}}

{{#if total_pages}}
<div
  x-data="paginationComponent({{page}}, {{total_pages}}, {{per_page}}, {{total_count}})"
  x-cloak
  style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 0; border-top: 1px solid var(--border-color); flex-wrap: wrap; gap: 0.5rem;"
>
  {{!-- Showing X-Y of Z records --}}
  <div style="font-size: 0.875rem; color: var(--text-secondary);">
    Showing <span x-text="showingFrom"></span>–<span x-text="showingTo"></span>
    of <span x-text="totalCount"></span> records
  </div>

  {{!-- Page navigation buttons --}}
  <nav
    x-show="totalPages > 1"
    style="display: inline-flex; gap: 0.25rem; align-items: center;"
  >
    {{!-- Previous button --}}
    <a
      :href="buildPageUrl(currentPage - 1)"
      :style="currentPage === 1
        ? 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-primary); opacity: 0.4; pointer-events: none;'
        : 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-primary);'"
      @mouseenter="if (currentPage !== 1) $el.style.background = 'var(--bg-secondary)'"
      @mouseleave="if (currentPage !== 1) $el.style.background = 'var(--bg-primary)'"
    >← Previous</a>

    {{!-- Page number buttons --}}
    <template x-for="item in pageItems" :key="item.key">
      <span style="display: contents;">
        <span
          x-show="item.type === 'ellipsis'"
          style="padding: 0.375rem 0.5rem; color: var(--text-muted); font-size: 0.875rem;"
        >…</span>
        <a
          x-show="item.type === 'page'"
          :href="buildPageUrl(item.page)"
          :style="item.page === currentPage
            ? 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--accent); color: white; background: var(--accent);'
            : 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-primary);'"
          @mouseenter="if (item.page !== currentPage) $el.style.background = 'var(--bg-secondary)'"
          @mouseleave="if (item.page !== currentPage) $el.style.background = item.page === currentPage ? 'var(--accent)' : 'var(--bg-primary)'"
          x-text="item.page"
        ></a>
      </span>
    </template>

    {{!-- Next button --}}
    <a
      :href="buildPageUrl(currentPage + 1)"
      :style="currentPage === totalPages
        ? 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-primary); opacity: 0.4; pointer-events: none;'
        : 'padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-primary);'"
      @mouseenter="if (currentPage !== totalPages) $el.style.background = 'var(--bg-secondary)'"
      @mouseleave="if (currentPage !== totalPages) $el.style.background = 'var(--bg-primary)'"
    >Next →</a>
  </nav>
</div>
{{/if}}

<script>
  function paginationComponent(currentPage, totalPages, perPage, totalCount) {
    return {
      currentPage,
      totalPages,
      perPage,
      totalCount,

      get showingFrom() {
        if (this.totalCount === 0) return 0;
        return (this.currentPage - 1) * this.perPage + 1;
      },

      get showingTo() {
        return Math.min(this.currentPage * this.perPage, this.totalCount);
      },

      get pageItems() {
        const pages = [];
        const total = this.totalPages;
        const current = this.currentPage;
        let keyIdx = 0;

        if (total <= 7) {
          for (let i = 1; i <= total; i++) {
            pages.push({ type: 'page', page: i, key: keyIdx++ });
          }
        } else if (current <= 4) {
          // Near start: 1 2 3 4 5 ... N
          for (let i = 1; i <= 5; i++) {
            pages.push({ type: 'page', page: i, key: keyIdx++ });
          }
          pages.push({ type: 'ellipsis', key: keyIdx++ });
          pages.push({ type: 'page', page: total, key: keyIdx++ });
        } else if (current >= total - 3) {
          // Near end: 1 ... N-4 N-3 N-2 N-1 N
          pages.push({ type: 'page', page: 1, key: keyIdx++ });
          pages.push({ type: 'ellipsis', key: keyIdx++ });
          for (let i = total - 4; i <= total; i++) {
            pages.push({ type: 'page', page: i, key: keyIdx++ });
          }
        } else {
          // Middle: 1 ... P-1 P P+1 ... N
          pages.push({ type: 'page', page: 1, key: keyIdx++ });
          pages.push({ type: 'ellipsis', key: keyIdx++ });
          for (let i = current - 1; i <= current + 1; i++) {
            pages.push({ type: 'page', page: i, key: keyIdx++ });
          }
          pages.push({ type: 'ellipsis', key: keyIdx++ });
          pages.push({ type: 'page', page: total, key: keyIdx++ });
        }

        return pages;
      },

      buildPageUrl(pageNum) {
        const params = new URLSearchParams(window.location.search);
        params.set('page', pageNum);
        return window.location.pathname + '?' + params.toString();
      }
    };
  }
</script>
