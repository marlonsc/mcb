schema: "rule/v1"
id: "CTOR001"
name: "Legacy DI Migration Required"
category: "dependency_injection"
severity: "error"
enabled: true
engine: "rust-rule-engine"

description: "Code still uses legacy DI patterns (#[derive(Component)], module! macro)"
rationale: "Legacy DI is replaced by dill IoC + linkme registry (ADR-029)"

config:
  migration_deadline: "v0.2.0"

rule: |
  rule LegacyDIMigrationRequired "Check for legacy DI usage" {
      when
          HasAttribute("derive(Component)") ||
          UsesMacro("module!")
      then
          Violation("Code still uses legacy DI patterns, migrate to dill/linkme by ${migration_deadline}");
  }
