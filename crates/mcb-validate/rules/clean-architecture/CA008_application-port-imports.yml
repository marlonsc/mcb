schema: "rule/v1"
id: "CA008"
name: "Application Ports Must Be Imported From Domain"
category: "architecture"
severity: "error"
enabled: true
engine: "rust-rule-engine"

description: "Application layer should not define provider traits locally; they must be imported from mcb-domain"
rationale: "Maintains single source of truth for interfaces in the domain layer"

patterns:
  # Reuses CA002 patterns for consistency
  port_trait_decl: '^\s*pub\s+trait\s+(\w+(?:Provider|Service))\s*(?::|where|\{)'
  domain_reexport: 'pub\s+use\s+mcb_domain::'

config:
  ports_dir: "src/ports/providers"

rule: |
  rule ApplicationPortImports "Application Ports Must Be Imported From Domain" {
      when
          Crate(name == "mcb-application") &&
          FilePath(contains "/src/ports/providers/") &&
          HasTraitDefinition() &&
          !HasReexport(from == "mcb-domain")
      then
          Violation("Provider traits must be imported from mcb-domain to ensure single source of truth");
  }
