_template: "cargo_dependency_check"
id: "CA002"
name: "Application Layer Boundaries"
category: "architecture"
severity: "error"
enabled: true
engine: "rusty-rules"

description: "Application crate only depends on domain"
rationale: "Application orchestrates domain logic without infrastructure details"

patterns:
  app_impl_import: 'use\s+{{application_module}}::(services|use_cases)::(\w+Impl)\b'
  app_service_import: 'use\s+{{application_module}}::\w+::(\w+Service)(?:Impl)?\b'
  port_trait_decl: '^\s*pub\s+trait\s+(\w+(?:Provider|Service))\s*(?::|where|\{)'
  domain_reexport: 'pub\s+use\s+{{domain_module}}::'

crate_name: "{{application_crate}}"
forbidden_prefixes: []
allowed_dependencies: ["{{domain_crate}}"]

config:
  crate_name: "{{application_crate}}"
  forbidden_prefixes: []
  allowed_dependencies: ["{{domain_crate}}"]

rule: |
  rule ApplicationBoundaries "Application Layer Boundaries" {
      when
          Crate(name == "{{application_crate}}") &&
          Dependencies(not all in ["{{domain_crate}}"])
      then
          Violation("Application layer can only depend on domain layer");
  }
